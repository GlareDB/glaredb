# ORDER BY with LIMIT and OFFSET

statement ok
SET verify_optimized_plan TO true;

statement ok
CREATE TEMP VIEW v1 AS
  SELECT repeat(a::text, b%8) AS a, b
    FROM generate_series(1, 1000) g1(a), generate_series(1, 100) g2(b);

query TI
SELECT a, b FROM v1 ORDER BY a DESC, b DESC LIMIT 10;
----
999999999999999999999  95
999999999999999999999  87
999999999999999999999  79
999999999999999999999  71
999999999999999999999  63
999999999999999999999  55
999999999999999999999  47
999999999999999999999  39
999999999999999999999  31
999999999999999999999  23

query TI
SELECT a, b FROM v1 ORDER BY a DESC, b DESC LIMIT 10 OFFSET 1000;
----
990990  26
990990  18
990990  10
990990  2
990     97
990     89
990     81
990     73
990     65
990     57

query TI
SELECT a, b FROM v1 ORDER BY a DESC, b ASC LIMIT 10 OFFSET 1000;
----
990990  74
990990  82
990990  90
990990  98
990     1
990     9
990     17
990     25
990     33
990     41

statement ok
CREATE TEMP VIEW v2 AS SELECT a, CASE WHEN b % 2 = 0 THEN b + NULL ELSE b END AS b FROM v1;

query TI
SELECT a, b FROM v2 ORDER BY a DESC, b DESC NULLS FIRST LIMIT 10;
----
999999999999999999999  95
999999999999999999999  87
999999999999999999999  79
999999999999999999999  71
999999999999999999999  63
999999999999999999999  55
999999999999999999999  47
999999999999999999999  39
999999999999999999999  31
999999999999999999999  23

query TI
SELECT a, b FROM v2 ORDER BY b DESC NULLS FIRST, a DESC LIMIT 10;
----
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL
999999999999999999  NULL

query TI
SELECT a, b FROM v2 ORDER BY b DESC NULLS FIRST, a DESC LIMIT 10 OFFSET 55005;
----
994  89
993  89
992  89
991  89
990  89
99   89
989  89
988  89
987  89
986  89

query TI
SELECT a, b FROM v2 ORDER BY b DESC NULLS LAST, a DESC LIMIT 10 OFFSET 55005;
----
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL
881881881881881881  NULL

