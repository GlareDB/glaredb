# Validation tests for gcs connections and external tables

include ./include/conn.slti

# Validation tests for create connection

# Validation test for connection with empty key
statement ok
CREATE CONNECTION empty_key
    FOR gcs OPTIONS (
        service_account_key = '',
    );

statement error
CREATE EXTERNAL TABLE empty_key_table
    FROM empty_key
    OPTIONS (
        bucket_name = '${GCS_BUCKET_NAME}',
        location = 'bikeshare_stations.csv'
    );

# Validation test for create external table

# Validation test with the wrong location
statement error
CREATE EXTERNAL TABLE missing_table
    FROM testconn
    OPTIONS (
        bucket_name = '${GCS_BUCKET_NAME}',
        location = 'missing_table.parquet'
    );

# Validation test with the wrong bucket name
statement error
CREATE EXTERNAL TABLE wrong_bucket_name
    FROM testconn
    OPTIONS (
        bucket_name = '${GCS_BUCKET_NAME}-wrong-bucket',
        location = 'bikeshare_stations.csv'
    );
