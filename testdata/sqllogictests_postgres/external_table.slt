# Basic tests for external tables.

statement ok
CREATE EXTERNAL TABLE external_table
	FROM postgres
	OPTIONS (
		connection_string = '${POSTGRES_CONN_STRING}',
		schema = 'public',
		table = 'bikeshare_stations',
	);

query I
SELECT count(*) FROM external_table;
----
102

statement ok
DROP TABLE external_table;

# Test if we can create external tables using expanded options.

# TODO: Use env vars instead of hard-coding values
statement ok
CREATE EXTERNAL TABLE external_table
	FROM postgres
	OPTIONS (
		host = 'localhost',
		port = '5433',
		user = 'glaredb',
		password = 'password',
		database = 'glaredb_test',
		schema = 'public',
		table = 'bikeshare_stations',
	);

query I
SELECT count(*) FROM external_table;
----
102

statement ok
DROP TABLE external_table;

statement ok
CREATE EXTERNAL TABLE external_table
	FROM postgres
	OPTIONS (
		host = 'localhost',
		port = '5433',
		user = 'glaredb',
		password = 'password',
		database = 'glaredb_test',
		schema = 'public',
		table = 'bikeshare_stations',
	)
	COLUMNS (
	  station_id int,
	);

query I
SELECT * FROM external_table ORDER BY station_id LIMIT 2; 
----
0
11


statement ok
CREATE EXTERNAL TABLE magic_test
	FROM postgres
	OPTIONS (
		host = 'localhost',
		port = '5433',
		user = 'glaredb',
		password = 'password',
		database = 'glaredb_test',
		schema = 'public',
		table = 'minimal_test',
	)
	COLUMNS (
		id int, 
		power int,
	);

query I
SELECT * FROM magic_test  ORDER BY id LIMIT 2; 
----
1 2
2 4

statement ok
CREATE EXTERNAL TABLE magic_test_type_error
	FROM postgres
	OPTIONS (
		host = 'localhost',
		port = '5433',
		user = 'glaredb',
		password = 'password',
		database = 'glaredb_test',
		schema = 'public',
		table = 'minimal_test',
	)
	COLUMNS (
		id int, 
		ordinal int,
		power text,
	);

statement error
SELECT * FROM magic_test_type_error ORDER BY id LIMIT 2; 

query I
SELECT * FROM magic_test WHERE power = 42; 
----
