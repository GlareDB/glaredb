# Basic tests for external database.

statement ok
CREATE EXTERNAL DATABASE external_db
	FROM postgres
	OPTIONS (
		connection_string = '${POSTGRES_CONN_STRING}',
	);

query I
SELECT count(*) FROM external_db.public.bikeshare_stations;
----
102

statement ok
DROP DATABASE external_db;

# Test if we can create external database using expanded options.

# TODO: Use env vars instead of hard-coding values
statement ok
CREATE EXTERNAL DATABASE external_db
	FROM postgres
	OPTIONS (
		host = 'localhost',
		port = '5432',
		user = 'glaredb',
		password = 'password',
		database = 'glaredb_test',
	);

query I
SELECT count(*) FROM external_db.public.bikeshare_stations;
----
102

# Ensure we can query into the virtual schema.

query TT
SELECT table_schema, table_name
	FROM external_db.virtual_catalog.tables
	WHERE table_name = 'bikeshare_stations';
----
public  bikeshare_stations

query TT
SELECT table_schema, table_name
	FROM external_db.virtual_catalog.tables
	WHERE table_schema = 'public' AND table_name = 'bikeshare_stations';
----
public  bikeshare_stations

statement ok
DROP DATABASE external_db;
