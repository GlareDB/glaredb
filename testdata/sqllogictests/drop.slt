# Tests drop database, schema and drop objects

# Test dropping databases

statement ok
create external database drop_db from debug;

query TTT
select database_name, external, datasource from glare_catalog.databases where database_name='drop_db';
----
drop_db t debug

statement ok
drop database drop_db;

statement error
drop database drop_db;

statement ok
drop database if exists drop_db;

query TTT
select database_name, external, datasource from glare_catalog.databases where database_name='drop_db';
----

# Test dropping empty schema

statement ok
create schema drop_schema;

statement ok
drop schema drop_schema;

statement error
drop schema drop_schema;

statement ok
drop schema if exists drop_schema;

query T
select schema_name from glare_catalog.schemas where schema_name='drop_table';
----

# Test drop schema with objects and drop table

statement ok
create schema drop_table;

statement ok
create external table drop_table.test
    from local
    options (
        location = 'testdata/sqllogictests_object_store/local/data/datatypes-data.csv',
    );

query TI
select c1, c3 from drop_table.test limit 1;
----
t 123

# We cannot drop a schema before removing the table or views (child objects on
# schema) without CASCADE.
statement error
drop schema drop_table;

query T
select schema_name from glare_catalog.schemas where schema_name='drop_table';
----
drop_table

# Drop schema even with child objects.
statement ok
drop schema drop_table cascade;

query TT
select schema_name, table_name from glare_catalog.tables where schema_name='drop_table' and table_name='test';
----

# Drop view

statement ok
create view test_view as select 1;

statement ok
drop view test_view;

statement error
drop view test_view;

statement ok
drop view if exists test_view;

query TT
select schema_name, view_name from glare_catalog.views where schema_name='drop_table' and view_name='test_view';
----

# Drop table and child objects on schema

statement ok
create schema drop_table;

statement ok
create external table drop_table.test
    from local
    options (
        location = 'testdata/sqllogictests_object_store/local/data/datatypes-data.csv',
    );

statement ok
drop table drop_table.test;

statement error
drop table drop_table.test;

statement ok
drop table if exists drop_table.test;

query TT
select schema_name, table_name from glare_catalog.tables where schema_name='drop_table' and table_name='test';
----

# Now that all dependent objects have been dropped we can drop the schema
statement ok
drop schema drop_table;

query T
select schema_name from glare_catalog.schemas where schema_name='drop_table';
----
